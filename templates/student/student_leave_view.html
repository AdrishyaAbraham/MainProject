{% extends 'hod/base_class.html' %}

{% block content %}
<body>
<div class="animated fadeIn">
      <div class="card">
          <div class="card-header">
              <i class="fa fa-edit"></i>Apply for Leave
          </div>

{% if messages %}
<div class="messages">
    {% for message in messages %}
    <div {% if message.tags %} class="{{ message.tags }}"{% endif %}>
        {{ message }}
    </div>
    {% endfor %}
</div>
{% endif %}

<form method="post">
    {% csrf_token %}
    
    {{ form.as_p }}
    <input type="submit" value="Apply for Leave">
</form>

<h2>Your Leave Applications</h2>
<div class="row">
    <div class="col-sm-12">
        <table class="table table-striped table-bordered datatable dataTable no-footer" id="DataTables_Table_0" role="grid" aria-describedby="DataTables_Table_0_info" style="border-collapse: collapse !important">
    <thead>
        <tr role="row">
            <th>Date of Leave</th>
            <th>Leave Message</th>
            <th>Applied On</th>
            <th>Status</th>
        </tr>
    </thead>
    <tbody>
        {% for leave in leaves %}
            <tr>
                <td>{{ leave.leave_date }}</td>
                <td>{{ leave.leave_message }}</td>
                <td>{{ leave.created_at }}</td>
                 <td>
                    {% if leave.leave_status == 0 %}
                        Pending
                    {% elif leave.leave_status == 1 %}
                        Approved
                    {% else %}
                        Rejected
                    {% endif %}
                </td>
            </tr>
        {% endfor %}
    </tbody>
</table>
</div>
</div>
</div>
</div>

<script>
window.onload = function() {
    const leaveDateInput = document.querySelector("#id_leave_date");
    
    leaveDateInput.addEventListener("change", function() {
        const selectedDate = new Date(this.value);
        const today = new Date();
        const oneWeekAgo = new Date(today.getTime() - 7 * 24 * 60 * 60 * 1000);

        // Check if the selected date is a Sunday
        if (selectedDate.getDay() !== 0) {
            alert("You can only apply for leave on Sundays.");
            this.value = "";  // Clear the input value
            return;
        }

        // Check if the date is from the current year
        if (selectedDate.getFullYear() !== today.getFullYear()) {
            alert("You can only apply for leaves from the current session year.");
            this.value = "";  // Clear the input value
            return;
        }

        // Check if the date is in the future
        if (selectedDate > today) {
            alert("You cannot apply for a leave in the future.");
            this.value = "";  // Clear the input value
            return;
        }

        // Check if the date is more than one week in the past
        if (selectedDate < oneWeekAgo) {
            alert("You can only apply for leave until one week after the date on which you were absent.");
            this.value = "";  // Clear the input value
            return;
        }
    });
};
</script>

</body>
{% endblock %}
